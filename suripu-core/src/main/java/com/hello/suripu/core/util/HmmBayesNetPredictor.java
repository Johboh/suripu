package com.hello.suripu.core.util;

import com.google.common.base.Optional;
import com.google.common.collect.ImmutableList;
import com.google.common.collect.Lists;
import com.google.common.collect.Maps;
import com.hello.suripu.algorithm.bayes.ProbabilitySegment;
import com.hello.suripu.algorithm.bayes.ProbabilitySegmenter;
import com.hello.suripu.algorithm.bayes.SensorDataReductionAndInterpretation;
import com.hello.suripu.api.datascience.SleepHmmBayesNetProtos;
import com.hello.suripu.core.models.AllSensorSampleList;
import com.hello.suripu.core.models.Event;
import com.hello.suripu.core.models.TrackerMotion;
import org.apache.commons.codec.binary.Base64;
import org.joda.time.DateTime;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.Collections;
import java.util.List;
import java.util.Map;

/**
 * Created by benjo on 6/24/15.
 */
public class HmmBayesNetPredictor {

    private static final String DEFAULT_PROTOBUF = "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PyH8qfHSTWJQPyH8qfHSTWJQPyGISbiQR3C/PyGAUmEqBfaDPyGwVu2akNbCPyH8qfHSTWJQPyENHTuoxHWkPyHbEyS2u4fgPyH8qfHSTWJQPyH8qfHSTWJQPyEKJTiayHGsPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyGsqpffaTK7PyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyGA1ZEjnYHTPyH8qfHSTWJQPyH8qfHSTWJQPyFAFTduMT/mPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyHNqQlHNZGOPyHt0/GYgcrhPyH8qfHSTWJQPyHw+sxZn3LGPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyHqkQa3tYW/PyHqkQa3tYW/PyGHzdeXMpF+PyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyGOpVnqajyCPyH8qfHSTWJQPyE4F9qUhnWmPyGDD8qgfyeqPyH8qfHSTWJQPyEdyHpq9dXnPyE+JefEHtrBPyH8qfHSTWJQPyFbX0XCzn9VPyFXdiQLVqRrPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyGnUv2UdN6yPyH8qfHSTWJQPyH8qfHSTWJQPyE1071O6kvtPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyElsFoVuKdhPyH8qfHSTWJQPyH8qfHSTWJQPyHsRZuAsmtzPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyHLaU/JObGjPyH8qfHSTWJQPyEL73IR34m9PyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyGwHvet1onNPyHLaU/JObGjPyH8qfHSTWJQPyGwHvet1onNPyH8qfHSTWJQPyF2k852O7GzPyH8qfHSTWJQPyH8qfHSTWJQPyEL73IR34m9PyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyHLaU/JObHDPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyHzyvW2mQrRPyH8qfHSTWJQPyFEMA4uHXPEPyH8qfHSTWJQPyG8kXnkDwbMPyH8qfHSTWJQPyH8qfHSTWJQPyGsCsM2mDy4PyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyFVt8TblDyIPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyF4Qq8/ic/PPyEAAAAAAAC4PyH8qfHSTWJQPyEAAAAAAAC4PyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyEX9N4YAoDdPyH8qfHSTWJQPyEAAAAAAACkPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyEAAAAAAAC8PyEAAAAAAACYPyH8qfHSTWJQPyH8qfHSTWJQPyEt6L0xBADHPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyEKJTiayHGsPyEKJTiayHGsPyEnF2NgHcfRPyH8qfHSTWJQPyGz0Tk/xXG8PyGz0Tk/xXHcPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyEKJTiayHGsPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyHBH37+e/DhPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyF/wAMDCB/cPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyEg8MAAwgfvPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyEJ/OHnvwefPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyHKxRhYx3HsPyEc8irGVFW1PyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyEKJTiayHGcPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyHKxRhYx3HsPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyHVN3pGbMG2PyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyEpDvuYasGWPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8AQ8MIHzgPyEJ/OHnvwePPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyEHfentz0WnPyH8qfHSTWJQPyGIvOXqxybbPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyHLaU/JObGjPyH8qfHSTWJQPyFYj/tW68TuPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyFN1xNdF37lPyH8qfHSTWJQPyF1VgvsMZGuPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyEC7Eia5OymPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyEwD5nyIajMPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyHD9Shcj8LlPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyF7FK5H4XrUPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyGamZmZmZnJPyEpDvuYasGmPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyGNfcnGgy3oPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyGamZmZmZm5PyH8qfHSTWJQPyGamZmZmZm5PyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyGamZmZmZm5PyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyFmZmZmZmbmPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyHVnYJXJlewPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyHGJ650iMmVPyFyUS0iisnFPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyH8qfHSTWJQPyGBe54/bdTnPyH8qfHSTWJQ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";
    private static final Logger LOGGER = LoggerFactory.getLogger(HmmBayesNetPredictor.class);

    private static final Double PROB_THRESHOLD = 0.95;

    private final HmmBayesNetDeserialization.DeserializedSleepHmmBayesNetWithParams allTheData;
    private final Map<String,EventProducer> eventProducers;

    public HmmBayesNetPredictor(HmmBayesNetDeserialization.DeserializedSleepHmmBayesNetWithParams allTheData) {
        this.allTheData = allTheData;

        //populate factory map
        eventProducers = Maps.newHashMap();
        eventProducers.put(HmmBayesNetMeasurementParameters.CONDITIONAL_PROBABILITY_OF_SLEEP,new SleepEventProducer());
        eventProducers.put(HmmBayesNetMeasurementParameters.CONDITIONAL_PROBABILITY_OF_BED,new BedEventProducer());

    }

    public static ImmutableList<Event> getBayesNetHmmEvents(final DateTime targetDate, final DateTime endDate,final long  currentTimeMillis,final long accountId,
                                                      final AllSensorSampleList allSensorSampleList, final List<TrackerMotion> myMotion,final int timezoneOffset) {



        final Long startTimeUTC = targetDate.minusMillis(timezoneOffset).getMillis();
        final Long endTimeUTC = startTimeUTC + 60000L * 60 * 16;

        final List<Event> outputEvents = Lists.newArrayList();

        try {
            final byte[] decodedBytes = Base64.decodeBase64(DEFAULT_PROTOBUF);

            //bytes to protobuf
            final SleepHmmBayesNetProtos.HmmBayesNet bayesNet = SleepHmmBayesNetProtos.HmmBayesNet.parseFrom(decodedBytes);

            //deserialize from protobuf
            final HmmBayesNetDeserialization.DeserializedSleepHmmBayesNetWithParams deserializedSleepHmmBayesNetWithParams = HmmBayesNetDeserialization.Deserialize(bayesNet);

            final HmmBayesNetPredictor predictor = new HmmBayesNetPredictor(deserializedSleepHmmBayesNetWithParams);

            final Map<String, List<Event>> eventsByOutputId = predictor.makePredictions(allSensorSampleList, myMotion, startTimeUTC, endTimeUTC, timezoneOffset);

            final List<Event> events = eventsByOutputId.get(HmmBayesNetMeasurementParameters.CONDITIONAL_PROBABILITY_OF_SLEEP);

            if (events == null) {
                return ImmutableList.copyOf(Collections.EMPTY_LIST);
            }

            outputEvents.addAll(events);

        }
        catch (Exception e) {
            LOGGER.error(e.toString());
        }

        return ImmutableList.copyOf(outputEvents);


    }

    //returns list of events by output id (the name of the conditional probabilities that produced it)
    public Map<String,List<Event>> makePredictions(final AllSensorSampleList allSensorSampleList, final List<TrackerMotion> pillData, final long startTimeUTC, final long stopTimeUTC, final int timezoneOffset) {
        Map<String, List<Event>> eventsByOutputId = Maps.newHashMap();

        /*  Get the sensor data */
        final Optional<SleepHmmBayesNetSensorDataBinning.BinnedData> binnedDataOptional = SleepHmmBayesNetSensorDataBinning.getBinnedSensorData(allSensorSampleList, pillData, allTheData.params, startTimeUTC, stopTimeUTC, timezoneOffset);

        if (!binnedDataOptional.isPresent()) {
            return eventsByOutputId;
        }

        final SleepHmmBayesNetSensorDataBinning.BinnedData binnedData = binnedDataOptional.get();

        return makePredictions(binnedData.data,binnedData.t0,timezoneOffset);
    }

    public Map<String,List<Event>> makePredictions(final double [][] sensorData,final long t0, final int timezoneOffset) {

        Map<String, List<Event>> eventsByOutputId = Maps.newHashMap();

        /* use models to get probabilities of states */
        final Map<String,List<List<Double>>> probsByOutputId = allTheData.sensorDataReductionAndInterpretation.inferProbabilitiesFromModelAndSensorData(sensorData);

        /* process probabilities by   */
        for (final String key : eventProducers.keySet()) {
            //get prob(true,forwards) OR prob(true,backwards), i.e.  !(!Pf * !Pb)
            final EventProducer producer = eventProducers.get(key);

            if (producer == null) {
                //TODO log error
                continue;
            }

            final List<Event> events = producer.getEventsFromProbabilitySequence(probsByOutputId,sensorData,t0,allTheData.params.numMinutesInMeasPeriod,timezoneOffset);

            eventsByOutputId.put(key,events);
        }

        return eventsByOutputId;

    }
}
